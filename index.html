<!DOCTYPE html>
<html>
<head>
<title>Gas Dashboard</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body>

<h2>CONFIGURATION</h2>

Name:
<input id="name">

Register:
<input id="reg">

<button onclick="addParam()">Add</button>

<h2>LIVE VALUES</h2>

<table border="1" id="tbl">
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</table>

<script>

const client = mqtt.connect(
"wss://9623f16bf00e4cc69f0010261f43bf86.s1.eu.hivemq.cloud:8884/mqtt",
{
 username:"RITESH",
 password:"Ritesh@123"
});

client.on("connect",()=>{
 console.log("MQTT Connected");
 client.subscribe("data/#");
});

// ADD PARAMETER
function addParam(){

 let n = document.getElementById("name").value.trim();
 let r = document.getElementById("reg").value.trim();

 if(!n || !r) return;

 // send config to ESP32
 client.publish("config/"+n, r);

 // add table row only once
 if(!document.getElementById("row_"+n)){
   let row = tbl.insertRow();
   row.id="row_"+n;

   row.insertCell(0).innerHTML=n;
   row.insertCell(1).innerHTML="--";
 }

 name.value="";
 reg.value="";
}

// RECEIVE DATA
client.on("message",(topic,msg)=>{

 let parts = topic.split("/");
 if(parts.length<2) return;

 let param = parts[1];
 let value = msg.toString();

 let row = document.getElementById("row_"+param);

 if(row){
   row.cells[1].innerHTML=value;
 }
});

</script>

</body>
</html>
